<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LPS Reporting Tool</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 900px; margin: auto; background-color: #f8f8f8; }
    h1, h2 { text-align: center; }
    label { font-weight: bold; margin-top: 10px; display: block; }
    input, textarea, select, button { width: 100%; margin: 5px 0 15px; padding: 8px; font-size: 14px; }
    .section { background: #fff; padding: 20px; margin: 20px 0; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .logo { text-align: right; }
    .footer-text { font-size: 8px; text-align: center; white-space: pre-wrap; margin-top: 20px; }
    .defect-block { margin-bottom: 30px; border-top: 1px solid #ccc; padding-top: 10px; }
  </style>
</head>
<body>
  <div class="section">
    <div class="logo">
      <img src="YOUR_LOGO_URL_HERE" alt="Company Logo" style="height: 60px;">
    </div>
    <h1>LPS Inspection Report</h1>
    <label>Site Address</label>
    <input type="text" id="site">
    <label>Engineer Name</label>
    <input type="text" id="engineer">
    <label>Date</label>
    <input type="date" id="date">
    <label>Test Kit Number</label>
    <input type="text" id="kit">
    <label>Building/Block Reference</label>
    <input type="text" id="building">
    <label>Weather & Ground Moisture</label>
    <input type="text" id="weather">
    <label>Standard Tested</label>
    <select id="standard">
      <option value="BSEN62305">BSEN62305</option>
      <option value="BS6651">BS6651</option>
      <option value="NF C 17-102:2011">NF C 17-102:2011</option>
      <option value="CP326:1965">CP326:1965</option>
    </select>
  </div>  <div class="section">
    <label>Select Fault:</label>
    <select id="fault">
      <option value="BSEN62305_Part3_E.7.2.4a">BSEN62305 - Part 3, Annex E, E.7.2.4 a)</option>
    </select>
    <label>Fault Notes</label>
    <textarea id="notes" rows="3"></textarea>
    <label>Upload Image</label>
    <input type="file" id="image" accept="image/*" capture="environment">
    <button onclick="addDefect()">Add Defect</button>
  </div>  <div class="section">
    <h2>Preview Defects</h2>
    <div id="defects"></div>
    <button onclick="generatePDF()">Generate PDF Report</button>
  </div>  <script>
    const defects = [];

    function addDefect() {
      const fault = document.getElementById("fault").value;
      const notes = document.getElementById("notes").value;
      const imageInput = document.getElementById("image");
      const file = imageInput.files[0];

      const reader = new FileReader();
      reader.onload = function(e) {
        const imageData = e.target.result;
        defects.push({
          clause: "Part 3, Annex E, E.7.2.4 a)",
          requirement: "The resistance to earth of each local earth electrode... (minimum requirement)",
          reason: "Unable to test one or more of the earth electrodes.",
          notes,
          image: imageData
        });
        renderDefects();
      };
      if (file) reader.readAsDataURL(file);
      else defects.push({ clause: "Part 3, Annex E, E.7.2.4 a)", requirement: "The resistance to earth of each local earth electrode...", reason: "Unable to test one or more of the earth electrodes.", notes, image: null }), renderDefects();
    }

    function renderDefects() {
      const div = document.getElementById("defects");
      div.innerHTML = defects.map((d, i) => `<div class='defect-block'><strong>Defect ${i+1}</strong><br>Minimum Requirement: ${d.requirement}<br>Reason for Defect: ${d.reason}<br>Notes: ${d.notes}</div>`).join('');
    }

    async function generatePDF() {
      const {{ jsPDF }} = window.jspdf;
      const doc = new jsPDF();
      let y = 20;

      const site = document.getElementById("site").value;
      const eng = document.getElementById("engineer").value;
      const date = document.getElementById("date").value;
      const kit = document.getElementById("kit").value;
      const build = document.getElementById("building").value;
      const weather = document.getElementById("weather").value;
      const std = document.getElementById("standard").value;

      doc.addImage("YOUR_LOGO_URL_HERE", "PNG", 150, 10, 40, 15);
      doc.setFontSize(18); doc.text("LPS Inspection Report", 105, y, { align: "center" }); y += 15;
      doc.setFontSize(12);
      doc.text(`Site Address: ${site}`, 20, y); y += 8;
      doc.text(`Engineer: ${eng}`, 20, y); y += 8;
      doc.text(`Date: ${date}`, 20, y); y += 8;
      doc.text(`Test Kit: ${kit}`, 20, y); y += 8;
      doc.text(`Building: ${build}`, 20, y); y += 8;
      doc.text(`Weather: ${weather}`, 20, y); y += 8;
      doc.text(`Standard Tested: ${std}`, 20, y);

      if (defects.length > 0) {
        doc.addPage(); y = 20;
        doc.setFontSize(16); doc.text("Defects", 105, y, { align: "center" }); y += 10;
        doc.setFontSize(12);
        doc.text(`Total Defects Found: ${defects.length}`, 20, y); y += 10;

        for (let i = 0; i < defects.length; i++) {
          const d = defects[i];
          doc.setFont(undefined, "bold");
          doc.text(`Defect ${i + 1}`, 20, y); y += 8;
          doc.setFont(undefined, "normal");
          doc.text(`Minimum Requirement: ${d.requirement}`, 20, y); y += 8;
          doc.text(`Reason for Defect: ${d.reason}`, 20, y); y += 8;
          if (d.notes) doc.text(`Notes: ${d.notes}`, 20, y); y += 8;

          if (d.image) {
            const img = new Image();
            img.src = d.image;
            await new Promise(res => img.onload = res);
            const imgHeight = 40;
            const imgWidth = 60;
            doc.addImage(img, "JPEG", 20, y, imgWidth, imgHeight);
            y += imgHeight + 5;
          }

          if (y > 260) { doc.addPage(); y = 20; }
        }
      }

      const footer = "Strike Point Lightning Protection Ltd - Registered office: Atkinson & Evans Ltd, 10 Arnot Hill Road, Nottingham NG5 6LJ.\nCompany No. 15114852, Registered in England and Wales. @: info@strikepoint.uk Tel: 0115 990 3220";
      const pages = doc.getNumberOfPages();
      for (let i = 1; i <= pages; i++) {
        doc.setPage(i);
        doc.setFontSize(8);
        doc.text(footer, 105, 290, { align: "center" });
      }

      doc.save("LPS-Report.pdf");
    }
  </script></body>
</html>
