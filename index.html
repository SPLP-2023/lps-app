<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LPS Reporting Tool</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
      background-color: #f9f9f9;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    textarea, select, input, button {
      display: block;
      margin-top: 10px;
      width: 100%;
      padding: 10px;
      font-size: 14px;
    }
    .section {
      margin-bottom: 30px;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    .defect-box {
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>LPS Reporting Tool</h1>  <div class="section">
    <label for="engineer">Engineer Name:</label>
    <input type="text" id="engineer" /><label for="site">Site Address:</label>
<input type="text" id="site" />

<label for="date">Date:</label>
<input type="date" id="date" />

<label for="kit">Test Kit Number:</label>
<input type="text" id="kit" />

<label for="building">Building Reference:</label>
<input type="text" id="building" />

<label for="weather">Weather & Ground Moisture Conditions:</label>
<input type="text" id="weather" />

<label for="standard">Standard Tested To:</label>
<select id="standard" onchange="showDefectOptions()">
  <option value="">Select a standard</option>
  <option value="BSEN62305">BSEN62305</option>
  <!-- Add other standards later -->
</select>

  </div>  <div class="section" id="defect-options" style="display:none">
    <h3>Select Defects:</h3>
    <label><input type="checkbox" value="E.7.2.4 a" onchange="addDefect(this)"> BSEN62305 - E.7.2.4 a) Earth electrode not tested in isolation</label>
  </div>  <div class="section">
    <h3>Defects Added:</h3>
    <div id="defect-list"></div>
  </div>  <div class="section">
    <button onclick="generatePDF()">Generate PDF Report</button>
  </div>  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>  <script>
    window.defects = [];

    function showDefectOptions() {
      const standard = document.getElementById("standard").value;
      const options = document.getElementById("defect-options");
      options.style.display = standard ? "block" : "none";
    }

    function addDefect(checkbox) {
      const list = document.getElementById("defect-list");
      if (checkbox.checked) {
        const box = document.createElement("div");
        box.className = "defect-box";
        box.setAttribute("data-clause", checkbox.value);

        const title = document.createElement("p");
        title.textContent = `Clause ${checkbox.value}`;

        const note = document.createElement("textarea");
        note.placeholder = "Reason for defect";

        const image = document.createElement("input");
        image.type = "file";
        image.accept = "image/*";

        box.appendChild(title);
        box.appendChild(note);
        box.appendChild(image);
        list.appendChild(box);
      } else {
        const boxes = document.querySelectorAll('.defect-box');
        boxes.forEach(box => {
          if (box.getAttribute("data-clause") === checkbox.value) {
            box.remove();
          }
        });
      }
    }

    async function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const engineer = document.getElementById("engineer").value;
      const site = document.getElementById("site").value;
      const date = document.getElementById("date").value;
      const kit = document.getElementById("kit").value;
      const building = document.getElementById("building").value;
      const weather = document.getElementById("weather").value;
      const standard = document.getElementById("standard").value;

      // ===== COVER PAGE =====
      doc.setFont("Helvetica", "bold");
      doc.setFontSize(22);
      doc.text("Lightning Protection System Inspection Report", 105, 20, { align: "center" });

      doc.setFont("Helvetica", "normal");
      doc.setFontSize(12);
      doc.text(`Engineer: ${engineer}`, 20, 40);
      doc.text(`Site Address: ${site}`, 20, 50);
      doc.text(`Date: ${date}`, 20, 60);
      doc.text(`Test Kit No.: ${kit}`, 20, 70);
      doc.text(`Building Reference: ${building}`, 20, 80);
      doc.text(`Weather & Ground Conditions: ${weather}`, 20, 90);
      doc.text(`Standard Tested To: ${standard}`, 20, 100);

      addFooter(doc, 297);

      const boxes = document.querySelectorAll(".defect-box");
      if (boxes.length > 0) {
        doc.addPage();
        doc.setFont("Helvetica", "bold");
        doc.setFontSize(18);
        doc.text(`Defects Found (${boxes.length})`, 20, 20);

        let y = 35;
        for (let i = 0; i < boxes.length; i++) {
          const clause = boxes[i].getAttribute("data-clause");
          const reason = boxes[i].querySelector("textarea").value;
          const file = boxes[i].querySelector("input[type='file']").files[0];

          doc.setFont("Helvetica", "bold");
          doc.setFontSize(14);
          doc.text(`Defect ${i + 1}`, 20, y);

          doc.setFont("Helvetica", "normal");
          doc.setFontSize(11);
          doc.text(`Minimum Requirement: Clause ${clause}`, 20, y + 10);
          doc.text(`Reason for Defect: ${reason}`, 20, y + 20);

          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              const img = new Image();
              img.onload = function () {
                doc.addImage(img, 'JPEG', 140, y + 5, 50, 40);
                y += 60;
                if (i === boxes.length - 1) {
                  addFooter(doc, 297);
                  doc.save("LPS_Report.pdf");
                }
              };
              img.src = e.target.result;
            };
            reader.readAsDataURL(file);
          } else {
            y += 60;
            if (i === boxes.length - 1) {
              addFooter(doc, 297);
              doc.save("LPS_Report.pdf");
            }
          }

          if (y > 250 && i < boxes.length - 1) {
            addFooter(doc, 297);
            doc.addPage();
            y = 20;
          }
        }
      } else {
        doc.save("LPS_Report.pdf");
      }
    }

    function addFooter(doc, pageHeight) {
      doc.setFontSize(8);
      doc.setTextColor(150);
      const footerText = `Strike Point Lightning Protection Ltd - Registered office: Atkinson & Evans Ltd, 10 Arnot Hill Road, Nottingham NG5 6LJ. Company No. 15114852, Registered in England and Wales. @: info@strikepoint.uk Tel: 0115 990 3220`;
      const lines = doc.splitTextToSize(footerText, 170);
      doc.text(lines, 105, pageHeight - 10, { align: "center" });
    }
  </script></body>
</html>
